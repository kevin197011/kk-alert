# 告警汇聚平台 产品需求文档（PRD）

**文档版本**: v0.9  
**创建日期**: 2025-02-10  
**角色**: 运维开发产品经理

---

## 1. 文档说明

### 1.1 目的

本文档描述告警汇聚平台（Alert Aggregation Platform）的产品需求，用于指导设计、开发与验收。面向研发、测试与运维团队。

### 1.2 范围

- 多数据源告警汇聚与统一管理
- 多渠道告警下发（Telegram、Lark）
- 告警模板、规则、历史与报表
- 前后端分离架构下的功能与约束

### 1.3 术语

| 术语 | 说明 |
|------|------|
| 告警汇聚平台 | 统一接入多数据源告警、配置规则与渠道并下发、可查询历史的系统 |
| 数据源 | 产生告警的监控系统，如 Prometheus、VictoriaMetrics、ES、Doris |
| 告警渠道 | 告警通知的送达方式，如 Telegram、Lark |
| 告警模板 | 用于格式化告警内容的可配置模板；主要基于告警的 tag（label）模式实现渲染 |
| 告警规则 | 定义哪些告警被接收、如何路由、抑制、聚合的配置 |
| 告警抑制 | 基于 tag 的抑制：当某类告警触发时，在时间窗口内不向渠道发送满足条件的其它告警 |
| Jira 工单创建 | 告警持续发生达到配置的 N 次后，自动在 Jira 创建工单以便跟进 |
| 按维度汇聚 | 相同类型告警按主机名、主机 IP 或端口汇聚后合并发送，实现智能化告警 |

---

## 2. 项目概述与目标

### 2.1 背景与问题

- 企业内存在多套监控（Prometheus、VictoriaMetrics、Elasticsearch、Doris 等），告警分散、格式不统一。
- 通知渠道多样（Telegram、飞书等），缺乏统一配置与审计。
- 缺少统一的告警历史与报表，不利于复盘与 SLA 分析。

### 2.2 产品目标

- **统一接入**：支持配置多个告警数据源（Prometheus、VictoriaMetrics、ES、Doris），将告警汇聚到同一平台。
- **灵活下发**：支持配置告警渠道（Telegram、Lark），按规则路由到对应渠道。
- **可定制展示**：通过告警模板自定义告警内容的格式与字段。
- **规则可配置**：支持告警规则配置（路由、抑制、聚合、静默等）。
- **可追溯**：每条告警具备唯一告警 ID，支持历史查询与报表导出。
- **安全可控**：支持认证与登录管理，前后端分离，便于扩展与集成。

### 2.3 用户角色

| 角色 | 描述 | 主要诉求 |
|------|------|----------|
| 运维工程师 | 日常值班、处理告警 | 配置数据源/渠道/规则、查看历史、导出报表 |
| 平台管理员 | 系统配置与用户管理 | 用户与权限、数据源与渠道的全局配置 |
| 开发/业务方 | 关注业务相关告警 | 按服务/标签查询历史、查看报表 |

---

## 3. 功能需求

### 3.1 告警数据源配置

#### 3.1.1 需求描述

系统支持配置多个告警数据源，从各数据源接收告警并做统一标准化处理。

#### 3.1.2 支持的数据源类型

| 数据源 | 说明 | 接入方式（建议） |
|--------|------|------------------|
| Prometheus | Prometheus Alertmanager 产生的告警 | Webhook 接收 / Alertmanager 配置推送到本平台 |
| VictoriaMetrics | VM 生态告警 | Webhook 或与 Prometheus 兼容的 API |
| Elasticsearch | ES 告警（Watcher、Elastalert2 等） | Webhook 或 ES 输出到本平台 HTTP 接口 |
| Apache Doris | 基于 Doris 的监控告警 | Webhook 或 HTTP 上报 |

#### 3.1.3 功能要点

- **数据源管理**：增删改查数据源，包含名称、类型、端点、认证方式（如 API Key、Basic Auth）、启用/停用状态。
- **接入验证**：配置保存后支持「测试连接」或「发送测试告警」，验证平台能收到该数据源的告警。
- **数据标准化**：将不同数据源的告警格式映射为平台统一数据模型（见 5.1），便于规则与模板使用。
- **多实例**：同一类型可配置多个实例（如多套 Prometheus），以数据源 ID 区分。

#### 3.1.4 验收标准

- 可为每种类型至少添加一个数据源并保存成功。
- 从 Prometheus/VM 通过 Webhook 发送一条告警，平台能接收并落库且生成唯一告警 ID。
- 数据源列表支持启用/停用，停用后不再接收该源告警（或可配置为仅不路由，仍落库）。

---

### 3.2 告警渠道配置

#### 3.2.1 需求描述

支持将告警按规则发送到不同通知渠道，当前需支持 Telegram、Lark（飞书）。

#### 3.2.2 渠道类型

| 渠道 | 说明 | 配置项（示例） |
|------|------|----------------|
| Telegram | Telegram Bot 推送 | Bot Token、默认 Chat ID、可选 Proxy |
| Lark (飞书) | 飞书群机器人 / 应用消息 | Webhook URL 或 App ID + App Secret + 群/用户 ID |

#### 3.2.3 功能要点

- **渠道管理**：增删改查渠道，配置与对应渠道所需的认证/端点信息；支持启用/停用。
- **安全**：Token、Secret 等敏感信息加密存储，前端不回显明文。
- **测试**：支持「发送测试消息」验证渠道可用性。
- **与规则联动**：告警规则中可引用渠道 ID，指定某类告警发往某渠道（见 3.4）。

#### 3.2.4 验收标准

- 配置 Telegram 与 Lark 各一个，保存后能发送测试消息并成功送达。
- 敏感配置在前端不展示明文；修改时支持「保留原值」或「填写新值」覆盖。

---

### 3.3 告警模板配置

#### 3.3.1 需求描述

支持自定义告警内容的展示格式，便于在不同渠道呈现一致、可读性高的告警信息。**告警模板主要基于 tag 模式实现**：模板渲染时以告警的 tag（label）为主要数据源，按 tag 键值组织内容，适配多数据源告警中「标签即结构」的共性。

#### 3.3.2 功能要点

- **模板管理**：增删改查告警模板，包含名称、适用渠道（可选：通用 / Telegram / Lark）、模板内容。
- **基于 tag 的模板语法**：
  - **以 tag 为主**：占位符优先引用告警的 tag/label，支持按 key 取值（如 `{{.Labels.job}}`、`{{.Labels.env}}`、`{{.Labels.instance}}`），以及遍历全部或部分 tag 输出（如 `{{range .Labels}}...{{end}}` 或预置的 `{{.Labels}}` 键值对展示）。模板内容编排应能围绕 tag 构建（如「服务：{{.Labels.service}} / 实例：{{.Labels.instance}}」）。
  - **通用字段补充**：除 tag 外，可引用告警统一模型字段，例如：`{{.AlertID}}`、`{{.Title}}`、`{{.Severity}}`、`{{.Source}}`、`{{.FiringAt}}`、`{{.Summary}}`、`{{.Annotations}}` 等，与 tag 组合使用。
  - 未存在或为空的 tag 引用时，渲染结果为空字符串或占位符（实现时约定），不报错。
- **多模板**：不同规则可绑定不同模板；同一渠道可有多套模板按场景切换。
- **预览**：提供基于示例数据（含示例 tag）的预览，便于调试 tag 占位符效果。

#### 3.3.3 验收标准

- 创建至少一个**以 tag 为主**的模板（如依赖 `{{.Labels.service}}`、`{{.Labels.env}}` 等），内容包含告警 ID、标题、级别、时间、摘要及若干 tag 字段；告警下发时使用该模板渲染后的内容在 Telegram 或 Lark 中正确展示，tag 值与实际告警一致。
- 告警无某 tag key 时，对应占位符渲染为空或约定占位，不导致发送失败。
- 修改模板后，新产生的告警使用新模板，历史告警不变。

---

### 3.4 告警规则配置

#### 3.4.1 需求描述

通过规则决定告警如何被处理：接收范围、路由到哪些渠道、是否抑制、聚合、静默等。

#### 3.4.2 功能要点

- **规则管理**：增删改查告警规则，包含名称、优先级/顺序、启用状态。
- **激活与禁止**：每条规则具备独立的状态「激活」或「禁止」。**激活**表示规则参与匹配与告警下发；**禁止**表示规则不参与匹配、不向渠道发送，仅保留配置（告警仍可入库、可被其他规则处理）。支持在规则列表与规则详情页对单条规则进行激活/禁止切换，状态变更即时生效；新建规则默认可为「激活」。列表与导出中需明确展示当前状态。
- **匹配条件**：按数据源、标签（如 `job`、`env`、`service`）、严重级别、关键词等过滤告警。
- **可选查询表达式（按数据源类型）**：规则可配置可选的数据源相关查询表达式。Prometheus 对应 **PromQL**，Elasticsearch 对应 **ES SQL**，Doris 对应 **SQL**。界面根据所选查询语言显示对应标签与输入框；当前仅存储供参考或后续拉取式告警扩展，不执行查询。
- **路由**：为匹配的告警指定一个或多个渠道（渠道 ID），以及使用的告警模板 ID。
- **检测频率**：每条规则可配置评估/检测频率（如每 30s、1m、5m），即按该周期检查告警是否匹配本规则并决定是否触发下发；未配置时使用平台默认频率。
- **持续时长**：支持配置「持续时长」门槛，仅当告警状态在连续一段时间内均满足规则条件时才触发发送（例如：持续 5 分钟才发、避免瞬时抖动）；未配置或为 0 表示匹配即发。
- **排除发送时间区间**：支持配置一个或多个「不发送」时间区间，在该区间内即使告警匹配规则也不向渠道发送（告警仍可入库、可查历史）。支持按日重复（如每日 22:00–08:00）、按星期（如每周六 00:00–06:00 维护窗口）、或指定绝对时间区间；区间可配置多段，且需支持时区或与系统时区一致。
- **告警恢复功能**：每条规则支持配置是否启用「告警恢复」通知。当告警从 firing 变为 resolved 时，若该规则启用了恢复功能，则向同一渠道发送一条恢复通知（内容可区分「告警已恢复」），便于值班确认。可选：支持为恢复通知配置独立模板（如「恢复模板」），或复用告警模板并传入 resolved 状态；未配置时默认不发送恢复通知。
- **告警发送频率配置**：每条规则支持配置告警发送频率限制，避免同一告警或同一组告警在短时间内重复刷屏。可选方式包括（实现时至少支持一种）：**同一告警最小发送间隔**（如同一 alert_id 5 分钟内只发一次）、**同一规则下发条数上限**（如每小时最多 N 条）、**同一标签组最小发送间隔**（如相同 tag 组合 10 分钟内只发一条）。超出频率的告警仍入库、可查历史，仅不向渠道发送；可配置「频率内重复是否合并为一条」等策略（二期）。
- **相同类型告警按维度汇聚与智能化发送**：对**相同类型**的告警（同一规则匹配、且除汇聚维度外标签一致），支持按**主机名、主机 IP 或端口**等维度汇聚后合并为一条或少量通知发送，实现智能化、降噪的告警发送。
  - **「相同类型」定义**：同一告警规则下，告警名称/告警指纹或除汇聚维度外的 tag 组合相同（如同一指标、同一告警名，仅 `instance`/`host`/`ip`/`port` 不同）。
  - **汇聚维度**：每条规则可配置汇聚维度为**主机名**、**主机 IP** 或**端口**（或组合）。维度从告警 tag 中映射，如 `instance`、`host`、`hostname`、`ip`、`port` 等（可配置 tag key 与维度对应关系）；未配置则不按维度汇聚，按原有单条发送逻辑。
  - **汇聚策略**：在可配置的**时间窗口**内，将同一类型、不同维度取值的多条告警聚合成一条通知：通知内容包含告警类型摘要 + 该类型下涉及的**主机名列表 / 主机 IP 列表 / 端口列表**（或数量统计，如「共 5 台主机」）；支持模板中使用汇聚后的变量（如 `{{.AggregatedHosts}}`、`{{.AggregatedCount}}`）。每条原始告警仍入库、保留独立告警 ID，仅发送侧做汇聚。
  - **智能化发送**：汇聚后避免「同一类告警 N 台主机发 N 条」，改为「一类告警发一条、内容含主机/IP/端口汇总」，便于值班快速识别范围与规模；可选支持超过数量上限时折叠为「共 N 台，前 K 台：…」（实现时约定）。
- **Jira 工单创建（按持续次数）**：每条规则可配置当告警**持续发生达到 N 次**时，自动创建 Jira 工单，便于将反复告警升级为工单跟进。
  - **持续次数阈值**：可配置次数 N（如 3、5、10 次）。「持续发生」定义为实现时可选的两种之一：（1）同一告警（同一 alert_id 或同一 fingerprint/标签组合）在时间窗口内重复触发的次数达到 N；（2）同一告警在连续 N 个评估周期内均为 firing。超过 N 次后触发工单创建。
  - **Jira 配置**：支持配置 Jira 项目 Key、Issue Type（如 Bug、Task）、工单摘要与描述模板（可基于告警 tag 与统一模型字段，同告警模板语法）。认证方式：Jira 域名/Base URL、API Token 或账号密码（敏感信息加密存储）；支持全局 Jira 配置与规则级覆盖（可选）。
  - **去重与关联**：同一告警在达到 N 次后只创建一次工单（推荐）；或支持「同一告警仅当尚未有关联工单时才创建」；创建后可将工单 Key 回写告警或告警历史，便于在平台内跳转查看。
- **告警抑制（基于 tag）**：支持基于告警标签（tag/label）的抑制，用于在某一类告警触发时，在时间窗口内不再向渠道发送与之匹配的其它告警，减少噪音。
  - **抑制规则配置**：可配置多条抑制规则；每条包含（1）**源匹配条件**：当告警的标签满足该条件时，视为「抑制源」触发；（2）**被抑制匹配条件**：在抑制生效期间，标签满足该条件的告警将被抑制（不发送到渠道，仍入库、可查历史）；（3）**抑制时长**：自抑制源触发起的时间窗口（如 5m、1h），窗口内被抑制匹配的告警均不发送。
  - **匹配方式**：源与被抑制条件均基于告警的 tag/label 键值匹配（如 `job=api`、`env=prod`），支持多 tag 组合（AND）；可选支持正则或包含关系（实现时约定）。
  - **作用范围**：抑制可为全局（所有规则触发的告警均参与判断），或与某条/某组告警规则绑定；同一告警可被多条抑制规则命中，命中任一则被抑制。
  - **去重与恢复**：同一抑制源在窗口内重复触发时，可刷新窗口或维持原窗口结束时间（实现时二选一）；窗口结束后，新产生的、满足被抑制条件的告警恢复正常下发。
- **可选高级能力**（可一期简化，二期扩展）：
  - 聚合：同一规则下多条告警合并为一条通知；与上条「按主机名/IP/端口汇聚」配合即可实现按维度聚合。
  - 静默：在指定时间段内不发送某类告警。
- **执行顺序**：规则按优先级或顺序执行，先匹配先生效（或支持「唯一匹配」策略）。
- **JSON 导入导出**：
  - **导出**：支持将单条或选中的多条告警规则导出为 JSON 文件；导出内容包含规则完整配置（名称、匹配条件、路由、模板引用、优先级、启用状态、检测频率、持续时长、排除发送时间区间、告警恢复开关与恢复模板、告警发送频率配置、按主机名/IP/端口汇聚配置、Jira 工单创建阈值与配置、告警抑制配置等），格式与平台规则数据模型一致，便于备份与跨环境迁移。
  - **导入**：支持上传 JSON 文件批量导入告警规则；支持「仅新增」「覆盖同名校验」等策略；导入前可预览解析结果，对渠道 ID、模板 ID 等引用做存在性校验，无效引用时提示并支持跳过或中止。
- **批量管理**：
  - **批量操作**：在规则列表中支持多选后执行批量启用/禁用、批量删除；可选支持批量修改优先级或批量更换绑定渠道/模板。
  - **操作反馈**：批量操作结果需明确反馈成功与失败条数及失败原因（如部分规则被引用时禁止删除）。

#### 3.4.4 验收标准

- 创建一条规则：匹配某数据源 + 某标签，路由到指定 Telegram 渠道并使用指定模板；触发一条匹配告警后，Telegram 收到且内容符合模板。
- **激活与禁止**：单条规则在列表或详情中切换为「禁止」后，新告警不再按该规则匹配与路由；切换回「激活」后立即重新参与匹配与下发。列表与详情中状态展示正确。
- 未匹配任何规则的告警可配置为「默认路由」或「仅入库不发送」（需在需求中明确策略）。
- **检测频率与持续时长**：配置检测频率 1m、持续时长 5m 时，仅在告警持续满足条件满 5 分钟后才发送；配置持续时长 0 或未填时，匹配即发。
- **排除发送时间区间**：配置「每日 22:00–08:00 不发送」后，该时间段内触发的告警不发送到渠道，但可在告警历史中查到；离开排除区间后若告警仍 firing，可按策略补发或仅对新产生的告警生效（具体策略需在实现中统一）。
- **告警恢复功能**：规则启用「告警恢复」后，当某条告警从 firing 变为 resolved 时，渠道能收到恢复通知；关闭后不发送恢复通知。恢复通知内容能区分于普通告警（如标题/文案含「已恢复」）。
- **告警发送频率配置**：配置「同一告警 5 分钟内只发一次」后，同一 alert_id 在 5 分钟内重复触发时仅第一次发送到渠道，后续不发送但可查历史；超过 5 分钟后若仍 firing 可再次发送（具体策略以实现为准）。
- **相同类型告警按维度汇聚与智能化发送**：规则开启「按主机名汇聚」且配置 tag 映射（如 `instance`→主机）后，同一规则下 5 台主机的同类告警在时间窗口内汇聚为一条通知，内容包含告警类型及 5 台主机列表（或「共 5 台」）；单条告警仍可在告警历史中按告警 ID 查询。按 IP 或端口汇聚时行为类似，仅维度不同。
- **Jira 工单创建（按持续次数）**：规则配置「持续发生 3 次后创建 Jira 工单」并填写有效 Jira 项目与认证后，当同一告警第 3 次触发时自动在 Jira 创建工单，工单摘要/描述包含告警信息；同一告警只创建一次工单（或按配置去重）。Jira 创建失败时应有日志或提示，不影响告警正常下发与入库。
- **告警抑制（基于 tag）**：配置「当存在标签 job=api 的告警时，抑制 30 分钟内所有 env=prod 的告警」后，在一条 job=api 的告警触发后的 30 分钟内，所有满足 env=prod 的告警不发送到渠道，但可在告警历史中查到；超过 30 分钟后新产生的 env=prod 告警恢复正常下发。
- **导入导出**：导出若干规则为 JSON 后，在另一环境或清空后重新导入，规则行为与导出前一致；导入含无效渠道/模板 ID 的 JSON 时，系统提示错误并不写入无效数据。
- **批量管理**：多选规则后批量禁用，仅选中规则被禁用；批量删除后列表中对应规则被移除；批量操作失败时给出明确原因。

---

### 3.5 告警历史与唯一告警 ID

#### 3.5.1 需求描述

每条告警在平台内具有唯一标识，并支持按多维度查询历史，便于排查与审计。

#### 3.5.2 功能要点

- **告警 ID**：平台在首次接收一条告警时生成全局唯一 ID（如 UUID 或雪花 ID），贯穿该告警的整个生命周期；若同一告警被去重/聚合，需在设计中明确 ID 与「聚合组」的关系（例如：原始告警各有一条 ID，聚合通知再记一条）。
- **存储**：告警 payload、标准化后的字段、数据源、接收时间、状态（如 firing、resolved、抑制、已发送）等落库。
- **历史查询**：支持按告警 ID、数据源、时间范围、标签、严重级别、状态等条件查询，分页展示。
- **详情**：点击某条历史可查看完整内容、关联的规则与渠道、发送记录（发往哪几个渠道、是否成功）。

#### 3.5.3 验收标准

- 任意一条入库告警都有唯一告警 ID，且在列表与详情中一致展示。
- 通过告警 ID 精确查询可命中该条告警。
- 支持按时间范围、数据源、级别查询并分页，结果正确。

---

### 3.6 告警报表与导出

#### 3.6.1 需求描述

支持对告警历史进行统计与可视化，并支持报表导出，便于周报、月报与 SLA 分析。

#### 3.6.2 功能要点

- **报表维度**：按时间（按小时/天/周/月）、数据源、严重级别、服务/标签等聚合统计告警数量、趋势。
- **可视化**：简单图表展示（如折线图、柱状图、饼图），可在前端固定若干报表视图（如「今日告警概览」「按数据源分布」「按级别分布」）。
- **导出**：支持将当前查询结果或报表数据导出为 CSV/Excel；可选按时间范围导出「某日/某周告警清单」。
- **权限**：导出与查看报表受登录与权限控制（见 3.8）。

#### 3.6.3 验收标准

- 选择时间范围与可选筛选条件后，能查看统计结果与图表。
- 支持导出当前列表或报表为 CSV（或 Excel），内容与页面展示一致。
- 未登录用户无法访问报表与导出接口。

---

### 3.7 系统架构与技术约束

#### 3.7.1 架构

- **前后端分离**：前端与后端独立部署、通过 HTTP/HTTPS API 通信。
- **后端**：采用 Golang 实现，提供 RESTful API；负责数据源接入、规则引擎、渠道推送、存储与查询。
- **前端**：采用 React + Ant Design，负责配置管理、历史查询、报表与导出、登录与权限 UI。

#### 3.7.2 技术栈（约定）

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 后端 | Golang | 主语言，版本建议 1.21+ |
| 前端 | React + Ant Design | UI 组件与工程化 |
| 数据存储 | 待定 | 建议 PostgreSQL/MySQL 存配置与告警元数据；若告警量大可考虑时序/检索库 |
| 认证 | 待定 | JWT 或 Session，见 3.8 |

#### 3.7.3 非功能要求

- **可用性**：数据源/渠道的配置变更不重启服务即可生效（或通过短时重载）。
- **安全**：敏感配置加密存储；API 除登录/健康检查外需认证。
- **可观测**：关键操作与发送失败有日志；可选指标暴露（如 Prometheus metrics）。

---

### 3.8 认证与登录管理

#### 3.8.1 需求描述

系统需要认证与登录管理，仅授权用户可访问配置、历史与报表。

#### 3.8.2 功能要点

- **登录**：用户通过用户名+密码登录（可选扩展：LDAP、OAuth2）。
- **会话**：登录成功后颁发 Token（如 JWT）或维持 Session；前端携带 Token 访问 API，后端校验通过后返回数据。
- **登出**：支持登出使 Token/Session 失效。
- **用户管理**（可选一期简化）：至少支持管理员维护用户列表（增删改）、初始密码或重置密码；可二期再做角色与权限细分（如只读角色）。
- **密码策略**：密码不明文存储；建议支持密码复杂度与过期策略（可二期）。

#### 3.8.3 验收标准

- 未登录访问配置页/历史页/报表页时跳转登录页。
- 正确用户名密码可登录并访问上述功能；错误密码提示失败。
- 登出后再次访问需重新登录。
- 所有需鉴权的 API 在无有效 Token 时返回 401。

---

## 4. 功能模块总览

```
┌─────────────────────────────────────────────────────────────────┐
│                        前端 (React + Ant Design)                  │
├──────────┬──────────┬──────────┬──────────┬──────────┬──────────┤
│ 登录/认证 │ 数据源   │ 渠道配置  │ 告警模板  │ 告警规则  │ 告警历史  │
│          │ 配置     │          │          │          │ 与报表   │
└──────────┴──────────┴──────────┴──────────┴──────────┴──────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────┐
│                    后端 API (Golang)                              │
├──────────┬──────────┬──────────┬──────────┬──────────┬──────────┤
│ 认证鉴权  │ 数据源   │ 渠道与   │ 模板     │ 规则     │ 历史与   │
│ (JWT等)  │ CRUD/接入 │ 推送     │ 渲染     │ 引擎     │ 查询/导出 │
└──────────┴──────────┴──────────┴──────────┴──────────┴──────────┘
                                    │
          ┌─────────────────────────┼─────────────────────────┐
          ▼                         ▼                         ▼
   Prometheus / VM           Telegram / Lark            数据库 / 存储
   ES / Doris (Webhook)      (API 调用)                 (告警+配置)
```

---

## 5. 数据与接口概要

### 5.1 告警统一数据模型（建议）

平台内部建议使用统一结构表示一条告警，便于规则与模板处理：

- `alert_id`：平台唯一 ID  
- `source_id`：数据源 ID  
- `source_type`：prometheus | victoriametrics | elasticsearch | doris  
- `external_id`：数据源侧原始 ID（若有）  
- `title`：标题  
- `severity`：严重级别  
- `status`：firing | resolved | suppressed 等  
- `firing_at` / `resolved_at`：时间  
- `labels`：键值对  
- `annotations`：键值对（描述、摘要等）  
- `raw`：原始 payload（可选，便于排查）

### 5.2 API 模块划分（建议）

- **/api/v1/auth**：登录、登出、刷新 Token、用户信息  
- **/api/v1/datasources**：数据源 CRUD、测试连接  
- **/api/v1/channels**：渠道 CRUD、发送测试  
- **/api/v1/templates**：模板 CRUD、预览  
- **/api/v1/rules**：规则 CRUD、启用/禁用、JSON 导入/导出、批量启用/禁用/删除（及可选批量更新）；告警抑制（基于 tag）、Jira 工单创建（按持续次数）配置可归属规则；可选独立 Jira 配置/测试接口（如 /api/v1/integrations/jira）  
- **/api/v1/alerts**：告警列表（历史）查询、详情、导出  
- **/api/v1/reports**：报表聚合接口（或合并到 alerts 的聚合查询）  
- **Webhook 接收**：`/api/v1/inbound/prometheus`、`/api/v1/inbound/victoriametrics`、`/api/v1/inbound/elasticsearch`、`/api/v1/inbound/doris` 等，供各数据源推送

（具体 HTTP 方法、路径、请求响应体以接口设计文档为准。）

---

## 6. 优先级与迭代建议

| 优先级 | 模块 | 说明 |
|--------|------|------|
| P0 | 认证登录、数据源配置、渠道配置、告警接收与唯一 ID、告警历史查询 | 最小可用：能接告警、能下发、能查历史 |
| P0 | 告警规则配置、告警模板 | 完整路由与展示 |
| P1 | 告警报表与导出 | 运营与复盘 |
| P2 | 抑制/聚合/静默、用户与权限细化、LDAP/OAuth2 | 高级规则与企业管理 |

---

## 7. 附录

### 7.1 参考

- Prometheus Alertmanager: https://prometheus.io/docs/alerting/latest/alertmanager/
- VictoriaMetrics: https://docs.victoriametrics.com/
- 飞书开放平台（机器人/应用）: https://open.feishu.cn/
- Telegram Bot API: https://core.telegram.org/bots/api

### 7.2 文档修订记录

| 版本 | 日期 | 修改说明 |
|------|------|----------|
| v0.1 | 2025-02-10 | 初稿：数据源、渠道、模板、规则、历史、报表、架构与认证 |
| v0.2 | 2025-02-10 | 告警规则支持 JSON 导入导出与批量管理 |
| v0.3 | 2025-02-10 | 告警规则支持检测频率、持续时长、排除发送时间区间 |
| v0.4 | 2025-02-10 | 每条规则增加激活与禁止功能（显式描述与验收） |
| v0.5 | 2025-02-10 | 增加告警抑制功能（基于 tag） |
| v0.6 | 2025-02-10 | 告警模板主要基于 tag 模式实现 |
| v0.7 | 2025-02-10 | 每条告警规则支持告警恢复功能与告警发送频率配置 |
| v0.8 | 2025-02-10 | 告警持续发生 N 次后支持 Jira 工单创建 |
| v0.9 | 2025-02-10 | 相同类型告警支持按主机名/主机 IP/端口汇聚与智能化告警发送 |

---

**文档结束**
