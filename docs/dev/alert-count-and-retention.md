# 告警数量为何会减少

告警数量（总数或“告警中”数量）变少，通常由以下原因造成。

## 1. 告警恢复（firing → resolved）

- **现象**：**告警中**数量减少，**已恢复**数量增加；**总条数**不变（直到被保留期清理）。
- **原因**：调度器每次执行规则时，若某条序列**不再出现在查询结果中**（例如实例已恢复、磁盘使用率回落），会将该告警标记为 `status=resolved` 并写入 `resolved_at`。
- **结论**：这是预期行为，表示条件已不再满足。

## 2. 历史数据保留期清理（retention）

- **现象**：**总告警数**减少，且日志中可见 `[retention] cleaned up N alert(s) older than ...`。
- **原因**：系统会按「历史数据保留天数」定期删除过期告警：
  - 逻辑在 `handlers.RunRetentionCleanup`：删除 **created_at 早于 (当前时间 - 保留天数)** 的告警及其发送记录。
  - 启动后约 1 分钟执行一次，之后每 **24 小时** 执行一次。
  - 保留天数来自系统设置 **历史数据保留天数**（默认 90 天），可在「系统设置」中修改（1–3650 天）。
- **结论**：超过保留期的历史告警会被自动删除，总数量因此下降。

## 3. 如何核对

- **告警历史页**：可按状态筛选「告警中」「已恢复」，确认是恢复导致“告警中”变少。
- **系统设置**：查看「历史数据保留天数」；若保留期较短，总数量会更快被清理。
- **后端日志**：搜索 `[retention]`，可确认何时清理了多少条告警。
